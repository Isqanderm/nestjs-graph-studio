# 📦 Release Guide - NestJS Graph Studio v0.1.0

This guide provides step-by-step instructions for publishing the first release of NestJS Graph Studio to npm.

---

## ✅ Pre-Release Checklist

### 1. GitHub Secrets Configuration

**Status:** ✅ **CONFIGURED**

- ✅ `NPM_TOKEN` is already configured in GitHub Secrets (created: 2025-10-30)

**How to verify:**
```bash
# Check via GitHub UI:
# Settings → Secrets and variables → Actions → Repository secrets
# You should see: NPM_TOKEN
```

**If you need to update the token:**
1. Go to [npmjs.com](https://www.npmjs.com/)
2. Login to your account
3. Click on your profile → Access Tokens
4. Generate New Token → Classic Token
5. Select "Automation" type (for CI/CD)
6. Copy the token
7. Go to GitHub repository → Settings → Secrets and variables → Actions
8. Update `NPM_TOKEN` secret with the new value

---

### 2. GitHub Environment Configuration

**Status:** ⚠️ **NEEDS SETUP**

The release workflow uses a GitHub Environment called `npm-publish` for additional security.

**To create the environment:**

1. Go to your repository on GitHub
2. Navigate to: **Settings → Environments**
3. Click **New environment**
4. Name: `npm-publish`
5. Click **Configure environment**
6. (Optional) Add protection rules:
   - ✅ **Required reviewers** - Add yourself or team members who must approve releases
   - ✅ **Wait timer** - Add a delay before deployment (e.g., 5 minutes)
   - ✅ **Deployment branches** - Restrict to tags matching `v*.*.*`
7. Click **Save protection rules**

**Why use an environment?**
- Adds an extra approval step before publishing to npm
- Prevents accidental releases
- Allows you to review the build before it goes live
- Can be configured to require manual approval

**Alternative (Skip Environment):**
If you want to publish without manual approval, you can remove the `environment: npm-publish` line from `.github/workflows/release.yml` (line 167).

---

### 3. Required Files

**Status:** ✅ **ALL PRESENT**

- ✅ `CHANGELOG.md` - Created with v0.1.0 entry
- ✅ `LICENSE` - MIT License present
- ✅ `README.md` - Comprehensive documentation
- ✅ `package.json` - Version set to 0.1.0

---

### 4. CI/CD Workflows

**Status:** ✅ **CONFIGURED**

All workflows are properly configured:

- ✅ **CI/CD Pipeline** (`.github/workflows/ci.yml`)
  - Runs on: PR to main, Push to main
  - Tests: Backend (229 tests), UI (177 tests)
  - Coverage: 93.22% backend, 76.10% UI
  - Build: UI + Library

- ✅ **Coverage Report** (`.github/workflows/coverage.yml`)
  - Runs on: Push to main
  - Generates detailed coverage reports

- ✅ **Security Check** (`.github/workflows/security.yml`)
  - Runs on: Push to main, Weekly schedule
  - CodeQL analysis, npm audit, license check

- ✅ **Release & Publish** (`.github/workflows/release.yml`)
  - Runs on: Push tag `v*.*.*`
  - Validates version, runs tests, builds, publishes to npm, creates GitHub release

---

## 🚀 Release Process

### Step 1: Merge PR to Main

First, merge the current PR (#1) into the main branch:

```bash
# Option A: Via GitHub UI (Recommended)
1. Go to https://github.com/Isqanderm/nestjs-graph-studio/pull/1
2. Click "Merge pull request"
3. Confirm merge

# Option B: Via Command Line
git checkout main
git pull origin main
git merge fix/ui-loading-and-routes-view
git push origin main
```

**What happens after merge:**
- ✅ CI/CD Pipeline runs (tests, build, coverage)
- ✅ Coverage Report generates detailed report
- ✅ Security Check runs CodeQL and npm audit

**Wait for all checks to pass before proceeding!**

---

### Step 2: Create and Push Version Tag

After the merge is complete and all checks pass:

```bash
# 1. Switch to main branch and pull latest changes
git checkout main
git pull origin main

# 2. Verify the version in package.json
cat package.json | grep version
# Should show: "version": "0.1.0"

# 3. Create the version tag
git tag -a v0.1.0 -m "Release v0.1.0 - Initial public release

Features:
- DI Graph Visualization
- Route Explorer
- Missing Dependency Detection
- Comprehensive Testing (93.22% coverage)
- Complete CI/CD Pipeline
"

# 4. Push the tag to GitHub
git push origin v0.1.0
```

**Alternative: Create tag via GitHub UI**
1. Go to: https://github.com/Isqanderm/nestjs-graph-studio/releases/new
2. Click "Choose a tag"
3. Type: `v0.1.0`
4. Click "Create new tag: v0.1.0 on publish"
5. Fill in release details (will be auto-generated by workflow)
6. Click "Publish release"

---

### Step 3: Monitor Release Workflow

After pushing the tag, the **Release & Publish** workflow will automatically start.

**Monitor progress:**
1. Go to: https://github.com/Isqanderm/nestjs-graph-studio/actions
2. Look for "Release & Publish" workflow
3. Click on the running workflow to see details

**Workflow stages:**

1. **Validate** (1-2 min)
   - ✅ Verifies package.json version matches tag (0.1.0 = v0.1.0)
   - ✅ Checks CHANGELOG.md has entry for v0.1.0

2. **Test** (3-5 min)
   - ✅ Runs full test suite (406 tests)
   - ✅ Verifies coverage thresholds (90% backend, 70% UI)

3. **Build** (2-3 min)
   - ✅ Builds UI (Vite)
   - ✅ Builds library (tsup)
   - ✅ Verifies all artifacts present

4. **Publish to npm** (1-2 min)
   - ⚠️ **May require manual approval** if environment protection is enabled
   - ✅ Publishes package to npm with provenance
   - ✅ Verifies package is available on npm

5. **Create GitHub Release** (1 min)
   - ✅ Extracts changelog for v0.1.0
   - ✅ Creates GitHub release with artifacts
   - ✅ Uploads build artifacts

**Total time: ~10-15 minutes**

---

### Step 4: Verify Publication

After the workflow completes successfully:

**1. Check npm:**
```bash
# View package on npm
npm view nestjs-graph-studio

# Check specific version
npm view nestjs-graph-studio@0.1.0

# Install and test
npm install nestjs-graph-studio@0.1.0
```

**2. Check npm website:**
- Visit: https://www.npmjs.com/package/nestjs-graph-studio
- Verify version 0.1.0 is published
- Check package details, README, and files

**3. Check GitHub Release:**
- Visit: https://github.com/Isqanderm/nestjs-graph-studio/releases
- Verify v0.1.0 release is created
- Check release notes and artifacts

**4. Test installation:**
```bash
# Create a test project
mkdir test-nestjs-graph-studio
cd test-nestjs-graph-studio
npm init -y
npm install nestjs-graph-studio@0.1.0

# Verify installation
ls node_modules/nestjs-graph-studio/dist/
# Should show: index.js, index.mjs, index.d.ts, ui/
```

---

## 🔧 Troubleshooting

### Issue: Environment approval required

**Symptom:** Workflow pauses at "Publish to npm" step

**Solution:**
1. Go to: https://github.com/Isqanderm/nestjs-graph-studio/actions
2. Click on the paused workflow
3. Click "Review deployments"
4. Select "npm-publish" environment
5. Click "Approve and deploy"

---

### Issue: Version mismatch error

**Symptom:** Workflow fails with "package.json version does not match tag version"

**Solution:**
```bash
# 1. Delete the tag locally and remotely
git tag -d v0.1.0
git push origin :refs/tags/v0.1.0

# 2. Update package.json version if needed
# Edit package.json and change version to match tag

# 3. Commit and push
git add package.json
git commit -m "chore: update version to 0.1.0"
git push origin main

# 4. Recreate and push tag
git tag -a v0.1.0 -m "Release v0.1.0"
git push origin v0.1.0
```

---

### Issue: npm publish fails with authentication error

**Symptom:** "npm ERR! code ENEEDAUTH" or "npm ERR! need auth"

**Solution:**
1. Verify NPM_TOKEN is valid:
   - Go to npmjs.com → Profile → Access Tokens
   - Check token is not expired
   - Token type should be "Automation"
2. Update GitHub secret if needed:
   - Settings → Secrets and variables → Actions
   - Update NPM_TOKEN with new token

---

### Issue: Tests fail during release

**Symptom:** Workflow fails at "Run Full Test Suite" step

**Solution:**
1. Check test results in workflow logs
2. Fix failing tests in a new branch
3. Create PR and merge to main
4. Delete and recreate tag after fix

---

## 📊 Post-Release Tasks

After successful publication:

### 1. Announce the Release

- ✅ Share on Twitter/X
- ✅ Post on Reddit (r/nestjs, r/typescript)
- ✅ Share on LinkedIn
- ✅ Update personal blog/website

### 2. Monitor Package

- ✅ Watch npm download stats
- ✅ Monitor GitHub issues
- ✅ Respond to community feedback

### 3. Update Documentation

- ✅ Add badges to README (npm version will auto-update)
- ✅ Update examples if needed
- ✅ Create tutorial videos/blog posts

### 4. Plan Next Release

- ✅ Create milestone for v0.2.0
- ✅ Gather feature requests
- ✅ Plan improvements based on feedback

---

## 📝 Quick Reference

**Merge PR:**
```bash
# Via GitHub UI or:
git checkout main && git merge fix/ui-loading-and-routes-view && git push
```

**Create Tag:**
```bash
git tag -a v0.1.0 -m "Release v0.1.0" && git push origin v0.1.0
```

**Verify Publication:**
```bash
npm view nestjs-graph-studio@0.1.0
```

**Monitor Workflow:**
https://github.com/Isqanderm/nestjs-graph-studio/actions

---

## ✅ Summary

**Prerequisites:**
- ✅ NPM_TOKEN configured
- ⚠️ npm-publish environment (optional, needs setup)
- ✅ CHANGELOG.md created
- ✅ All files ready

**Release Steps:**
1. Merge PR to main
2. Wait for CI checks to pass
3. Create and push v0.1.0 tag
4. Monitor release workflow
5. Verify publication on npm and GitHub

**Expected Timeline:**
- Merge: 5-10 minutes (CI checks)
- Release: 10-15 minutes (workflow)
- Total: ~20-25 minutes

---

**Ready to release? Follow the steps above and good luck! 🚀**

